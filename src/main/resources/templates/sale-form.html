<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nesto - Create Sale</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f4f7f6; padding: 40px; font-family: 'Poppins', sans-serif; }
        .bill-card { background: white; border-radius: 15px; padding: 30px; max-width: 800px; margin: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .product-row { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="bill-card">
    <h3 class="text-center mb-4">New Sales Entry</h3>
    <form th:action="@{/sales/save}" method="post" id="saleForm">

        <div class="mb-4">
            <label class="form-label fw-bold">Select Customer</label>
            <select name="customerId" class="form-select" required>
                <option value="" disabled selected>Choose a customer...</option>
                <option th:each="c : ${customers}" th:value="${c.id}" th:text="${c.name}"></option>
            </select>
        </div>

        <div id="product-container">
            <label class="form-label fw-bold">Items</label>
            <div class="row product-row">
                <div class="col-md-7">
                    <select name="productIds" class="form-select" required>
                        <option value="" disabled selected>Select Product</option>
                        <option th:each="p : ${products}" th:value="${p.id}" th:text="${p.name + ' (â‚¹' + p.price + ')'}"></option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="number" name="quantities" class="form-control" placeholder="Qty" min="1" value="1" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger w-100" onclick="removeRow(this)"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </div>

        <button type="button" class="btn btn-outline-primary btn-sm mb-4" onclick="addRow()">+ Add Another Item</button>

        <div class="d-flex justify-content-between">
            <a th:href="@{/sales}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-success px-5">Generate Bill</button>
        </div>
    </form>
</div>

<script>
    function addRow() {
        const container = document.getElementById('product-container');
        const firstRow = document.querySelector('.product-row');
        const newRow = firstRow.cloneNode(true);
        // Reset values in cloned row
        newRow.querySelector('select').selectedIndex = 0;
        newRow.querySelector('input').value = 1;
        container.appendChild(newRow);
    }

    function removeRow(button) {
        const rows = document.querySelectorAll('.product-row');
        if (rows.length > 1) {
            button.closest('.product-row').remove();
        } else {
            alert("At least one product is required.");
        }
    }
</script>
</body>
</html>